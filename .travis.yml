sudo: required

services:
  - docker

before_install:
  - docker version
  - docker network create --driver=bridge --subnet=192.168.0.0/16 --opt="com.docker.network.driver.mtu=1450" --opt="com.docker.network.bridge.name=redd0" nanobox
  - ifconfig

jobs:
  include:
    - stage: test
      script:
        - make test-9.3
    - script:
        - make test-9.4
    - script:
        - make test-9.5
    - script:
        - make test-9.6
    - script:
        - make test-10
    - stage: publish
      script:
        - export BRANCH=$(if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then echo $TRAVIS_BRANCH; else echo $TRAVIS_PULL_REQUEST_BRANCH; fi)
        - if [ "$BRANCH" == "master" ]; then make; fi